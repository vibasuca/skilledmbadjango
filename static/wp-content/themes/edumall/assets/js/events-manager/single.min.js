!function(r){"use strict";r(document).ready(function(){d.init();var e,n,t,o,s,a,i=r("#entry-event-countdown");0<i.length&&(n=(e=(i=i).data()).time,t=e.daysText||$edumall.countdownDaysText,o=e.hoursText||$edumall.countdownHoursText,s=e.minutesText||$edumall.countdownMinutesText,a=e.secondsText||$edumall.countdownSecondsText,i.countdown(n,function(e){var n='<div class="countdown-section hour"><span class="countdown-amount">%H</span><span class="countdown-period">'+o+'</span></div><div class="countdown-section minute"><span class="countdown-amount">%M</span><span class="countdown-period">'+s+'</span></div><div class="countdown-section second"><span class="countdown-amount">%S</span><span class="countdown-period">'+a+"</span></div>",n='<div class="countdown-row">'+(n=0<e.offset.totalDays?'<div class="countdown-section day"><span class="countdown-amount">%D</span><span class="countdown-period">'+t+"</span></div>"+n:n)+"</div>";r(this).html(e.strftime(n))}))});var d={init:function(){var e=r(document);e.on("click",".event-load-booking-form",this.load_form_register),e.on("submit","form.event_register:not(.active)",this.book_event_form),e.on("submit","#event-lightbox .event-auth-form",this.ajax_login)},load_form_register:function(e){e.preventDefault();var n=r(this),e=n.attr("data-event");r.ajax({url:WPEMS.ajaxurl,type:"POST",dataType:"html",data:{event_id:e,nonce:WPEMS.register_button,action:"load_form_register"},beforeSend:function(){n.addClass("updating-icon")},success:function(e){d.lightbox(e)},complete:function(){n.removeClass("updating-icon")}})},book_event_form:function(e){e.preventDefault();var n=r(this),e=n.serializeArray(),t=n.find('button[type="submit"]'),o=n.find(".tp-event-notice");return r.ajax({url:WPEMS.ajaxurl,type:"POST",data:e,dataType:"json",beforeSend:function(){o.slideUp().remove(),t.addClass("event-register-loading"),n.addClass("active")}}).done(function(e){t.removeClass("event-register-loading"),void 0===e.status?d.set_message(n,WPEMS.something_wrong):(!0===e.status&&void 0!==e.url&&""!==e.url&&(window.location.href=e.url),!0===e.status&&""==e.url&&void 0!==e.event&&(r.magnificPopup.close(),r(".woocommerce-message").hide(),setTimeout(function(){r(".entry-register, .event_register_foot").append('<div class="woocommerce-message">'+WPEMS.woo_cart_url+"<p>“"+e.event+"”"+WPEMS.add_to_cart+"</p></div>")},100)),void 0!==e.message&&d.set_message(n,e.message))}).fail(function(){t.removeClass("event-register-loading"),d.set_message(n,WPEMS.something_wrong)}).always(function(){n.removeClass("active")}),!1},set_message:function(e,n){var t=(t='<div class="tp-event-notice error">')+('<div class="event_auth_register_message_error">'+n+"</div>")+"</div>";e.find(".event_register_foot").append(t)},sanitize_form_field:function(){for(var e=r(".form-row.form-required"),n=0;n<e.length;n++)r(e[n]).find("input").on("blur",function(e){e.preventDefault();var e=r(this),n=e.parents(".form-row:first");n.hasClass("form-required")&&(""==e.val()?n.removeClass("validated").addClass("has-error"):n.removeClass("has-error").addClass("validated"))})},lightbox:function(e){var n=[];n.push('<div id="event-lightbox">'),n.push(e),n.push("</div>"),r.magnificPopup.open({items:{type:"inline",src:r(n.join(""))},mainClass:"event-lightbox-wrap",callbacks:{open:function(){var e=r("#event-lightbox"),n=(e.addClass("event-fade"),setTimeout(function(){e.addClass("event-in"),clearTimeout(n),d.sanitize_form_field()},100))},close:function(){r("#event-lightbox").remove()}}})},ajax_login:function(e){e.preventDefault();var o=r(this),n=o.find("#wp-submit"),t=r("#event-lightbox"),e=o.serializeArray();return r.ajax({url:WPEMS.ajaxurl,type:"POST",data:e,async:!1,beforeSend:function(){t.find(".tp-event-notice").slideUp().remove(),n.addClass("event-register-loading")}}).always(function(){n.find(".event-icon-spinner2").remove()}).done(function(e){void 0!==e.notices&&o.before(e.notices),void 0!==e.status&&!0===e.status&&(void 0!==e.redirect&&e.redirect?window.location.href=e.redirect:window.location.reload())}).fail(function(e,n,t){o.before(res.notices)}),!1}}}(jQuery);